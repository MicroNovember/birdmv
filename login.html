<!DOCTYPE html>
<html lang="th">
<head>
    <title>SAMORN Movie | Login</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="assets/css/style.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <!-- Firebase Configuration -->
    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBt8BVo655fDa1YZJrLFdfiJ2eID40ei9A",
            authDomain: "samorn-mv.firebaseapp.com",
            projectId: "samorn-mv",
            storageBucket: "samorn-mv.firebasestorage.app",
            messagingSenderId: "812347002959",
            appId: "1:812347002959:web:69e39d2827308dfb571a3a",
            measurementId: "G-3DG3NS8VLF"
        };

        // Initialize Firebase (check if already initialized)
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();
        
        // Make Firebase available globally
        window.db = db;
    </script>
    
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .login-card {
            background: rgba(17, 24, 39, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        .float-animation {
            animation: float 6s ease-in-out infinite;
        }
        
        .glow-effect {
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
        }
        
        .vip-gradient {
            background: linear-gradient(135deg, #f59e0b 0%, #dc2626 100%);
        }
        
        .guest-gradient {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    
    <!-- Background Animation -->
    <div class="fixed inset-0 overflow-hidden">
        <div class="absolute top-20 left-20 w-72 h-72 bg-purple-500 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-pulse"></div>
        <div class="absolute top-40 right-20 w-72 h-72 bg-yellow-500 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-pulse animation-delay-2000"></div>
        <div class="absolute bottom-20 left-1/2 w-72 h-72 bg-pink-500 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-pulse animation-delay-4000"></div>
    </div>
    
    <!-- Login Container -->
    <div class="relative z-10 w-full max-w-md">
        
        <!-- Logo Section -->
        <div class="text-center mb-8 float-animation">
            <h1 class="text-5xl md:text-6xl font-black tracking-tighter italic mb-2">
                <span class="text-blue-400">SAMORN</span>
                <span class="text-white">MOVIE</span>
            </h1>
            <p class="text-gray-300 text-lg">สตรีมมิ่งหนังออนไลน์คุณภาพสูง</p>
        </div>
        
        <!-- Login Card -->
        <div class="login-card rounded-3xl p-8 shadow-2xl">
            <div class="text-center mb-8">
                <h2 class="text-2xl font-bold text-white mb-2">เลือกวิธีเข้าใช้งาน</h2>
                <p class="text-gray-400 text-sm">คุณต้องการเข้าใช้งานในรูปแบบใด?</p>
            </div>
            
            <!-- Guest Access Button -->
            <button onclick="loginAsGuest()" class="w-full mb-4 p-6 rounded-2xl guest-gradient text-white font-bold text-lg transition-all duration-300 hover:scale-105 hover:shadow-xl group">
                <div class="flex items-center justify-center">
                    <svg class="w-8 h-8 mr-3 group-hover:rotate-12 transition-transform" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"></path>
                    </svg>
                    <div class="text-left">
                        <div>เข้าชมแบบ Guest</div>
                        <div class="text-sm opacity-80">ฟรี! ดูหนังทั่วไปได้</div>
                    </div>
                </div>
            </button>
            
            <!-- VIP Access Button -->
            <button onclick="showVipLogin()" class="w-full p-6 rounded-2xl vip-gradient text-white font-bold text-lg transition-all duration-300 hover:scale-105 hover:shadow-xl glow-effect group">
                <div class="flex items-center justify-center">
                    <svg class="w-8 h-8 mr-3 group-hover:rotate-12 transition-transform" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                    </svg>
                    <div class="text-left">
                        <div>เข้าชมแบบ VIP</div>
                        <div class="text-sm opacity-80">พิเศษ! ดูหนัง VIP ทั้งหมด</div>
                    </div>
                </div>
            </button>
            
            <!-- Features Comparison -->
            <div class="mt-6 pt-6 border-t border-gray-700 text-center">
                <div class="bg-gradient-to-r from-yellow-500/20 to-orange-600/20 rounded-lg p-4 border border-yellow-500/30">
                    <div class="flex items-center justify-center mb-2">
                        <svg class="w-5 h-5 text-yellow-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                        </svg>
                        <h3 class="text-yellow-500 font-semibold text-sm">VIP Code ฟรี!</h3>
                    </div>
                    <p class="text-gray-300 text-xs leading-relaxed">
                        แจกฟรี! หาได้จาก Open Group LINE ยอดนิยม<br>
                        ค้นหา: "SAMORN Movie VIP" ใน LINE<br>
                        จำกัด 3 อุปกรณ์ต่อ IP (12 ชม.)
                    </p>
                    <div class="mt-3 flex items-center justify-center space-x-3">
                        <div class="flex items-center text-xs text-gray-400">
                            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.293l-3-3a1 1 0 00-1.414 1.414L10.586 9.5H7a1 1 0 100 2h3.586l-1.293 1.293a1 1 0 101.414 1.414l3-3a1 1 0 000-1.414z" clip-rule="evenodd"></path>
                            </svg>
                            <span>รีบรับ!</span>
                        </div>
                        <div class="flex items-center text-xs text-gray-400">
                            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path>
                            </svg>
                            <span>ปลอดภัย</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mt-8 p-4 bg-gray-800/50 rounded-xl">
                <h3 class="text-white font-semibold mb-3 text-center">เปรียบเทียบฟีเจอร์</h3>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span class="text-gray-400">หนังทั่วไป</span>
                        <span class="text-green-400">✅ Guest ✅ VIP</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">หนัง VIP</span>
                        <span class="text-red-400">❌ Guest ✅ VIP</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">ความละเอียดสูง</span>
                        <span class="text-yellow-400">⭐ Guest ⭐⭐ VIP</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- VIP Login Modal -->
        <div id="vip-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-[70] hidden flex items-center justify-center p-4">
            <div class="bg-gray-800 rounded-2xl p-8 max-w-md w-full border border-gray-700 shadow-2xl">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-gradient-to-br from-yellow-500 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-white mb-2">VIP Access</h2>
                    <p class="text-gray-400 text-sm">กรุณาใส่รหัส VIP 4 ตัวเพื่อเข้าใช้งาน</p>
                </div>
                
                <div class="space-y-4">
                    <div class="flex justify-center space-x-2">
                        <input type="text" maxlength="1" class="vip-input w-14 h-14 bg-gray-700 border border-gray-600 rounded-lg text-center text-2xl font-bold focus:border-yellow-500 focus:ring-2 focus:ring-yellow-500/20 transition" data-index="0">
                        <input type="text" maxlength="1" class="vip-input w-14 h-14 bg-gray-700 border border-gray-600 rounded-lg text-center text-2xl font-bold focus:border-yellow-500 focus:ring-2 focus:ring-yellow-500/20 transition" data-index="1">
                        <input type="text" maxlength="1" class="vip-input w-14 h-14 bg-gray-700 border border-gray-600 rounded-lg text-center text-2xl font-bold focus:border-yellow-500 focus:ring-2 focus:ring-yellow-500/20 transition" data-index="2">
                        <input type="text" maxlength="1" class="vip-input w-14 h-14 bg-gray-700 border border-gray-600 rounded-lg text-center text-2xl font-bold focus:border-yellow-500 focus:ring-2 focus:ring-yellow-500/20 transition" data-index="3">
                    </div>
                    
                    <div id="vip-error" class="hidden bg-red-500/20 border border-red-500/50 rounded-lg p-3 text-red-400 text-sm text-center">
                        รหัสไม่ถูกต้อง กรุณาลองใหม่
                    </div>
                    
                    <div class="flex space-x-3">
                        <button onclick="closeVipModal()" class="flex-1 px-4 py-3 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition font-medium">
                            ยกเลิก
                        </button>
                        <button onclick="verifyVipCode()" class="flex-1 px-4 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 hover:from-yellow-600 hover:to-orange-700 text-white rounded-lg transition font-medium">
                            เข้าสู่ระบบ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="assets/js/vip-auth.js"></script>
    <script>
        // Login functions
        function loginAsGuest() {
            localStorage.setItem('user_type', 'guest');
            window.location.href = 'index.html';
        }
        
        function showVipLogin() {
            if (window.vipAuth) {
                window.vipAuth.showVipModal();
            }
        }
        
        function closeVipModal() {
            if (window.vipAuth) {
                window.vipAuth.closeVipModal();
            }
        }
        
        function verifyVipCode() {
            if (window.vipAuth) {
                window.vipAuth.verifyVipCode();
            }
        }
        
        // Check if already logged in
        window.addEventListener('DOMContentLoaded', async () => {
            const userType = localStorage.getItem('user_type');
            const vipData = localStorage.getItem('vip_access');
            
            if (userType === 'vip' && vipData) {
                const vip = JSON.parse(vipData);
                if (vip.expires && new Date(vip.expires) > new Date()) {
                    // Check if session still valid
                    if (vip.sessionId && window.db) {
                        try {
                            const sessionDoc = await window.db.collection('vip_sessions').doc(vip.sessionId).get();
                            if (sessionDoc.exists) {
                                // VIP still valid, redirect to main site
                                window.location.href = 'index.html';
                                return;
                            }
                        } catch (error) {
                            console.error('Error checking session:', error);
                        }
                    } else {
                        // No Firebase check, just redirect
                        window.location.href = 'index.html';
                        return;
                    }
                }
            }
            
            if (userType === 'guest') {
                // Guest user, redirect to main site
                window.location.href = 'index.html';
                return;
            }
            
            // Initialize VIP Auth
            if (window.VipAuth) {
                window.vipAuth = new window.VipAuth();
                
                // Override VIP success to redirect
                const originalGrantVipAccess = window.vipAuth.grantVipAccess.bind(window.vipAuth);
                window.vipAuth.grantVipAccess = async function(code, vipData) {
                    try {
                        // Get user IP
                        const ipResponse = await fetch('https://api.ipify.org?format=json');
                        const ipData = await ipResponse.json();
                        const userIP = ipData.ip;
                        
                        // Check existing VIP sessions for this IP
                        const existingSessions = await this.checkIPSessions(userIP);
                        
                        if (existingSessions.length >= 3) {
                            this.showVipError('IP นี้ล็อกอิน VIP ครบ 3 อุปกรณ์แล้ว');
                            return;
                        }
                        
                        // Set expiration (12 hours from now)
                        const expires = new Date(Date.now() + 12 * 60 * 60 * 1000);
                        
                        // Create session ID
                        const sessionId = this.generateSessionId();
                        
                        // Save to localStorage with IP and session ID
                        localStorage.setItem('vip_access', JSON.stringify({
                            code: code,
                            expires: expires.toISOString(),
                            verified: true,
                            ip: userIP,
                            sessionId: sessionId,
                            deviceName: this.getDeviceName()
                        }));
                        
                        // Save session to Firebase
                        await this.saveVipSession(userIP, sessionId, code, expires);
                        
                        // Set user type as VIP
                        localStorage.setItem('user_type', 'vip');
                        
                        // Show success message with device count
                        const deviceCount = existingSessions.length + 1;
                        this.showSuccessMessage(`VIP Access Granted! Device ${deviceCount}/3`);
                        
                        // Redirect to main site
                        setTimeout(() => {
                            window.location.href = 'index.html';
                        }, 1500);
                        
                    } catch (error) {
                        console.error('VIP Access Error:', error);
                        this.showVipError('เกิดข้อผิดพลาด กรุณาลองใหม่');
                    }
                };
            }
        });
    </script>
    <script src="assets/js/tv-detection.js"></script>
    <script src="assets/js/tv-navigation.js"></script>
</body>
</html>
